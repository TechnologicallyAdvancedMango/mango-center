<!DOCTYPE html>
<html>
<head>
	<title>Bad Apple</title>
	<link rel="icon" href="bad_apple_favicon.gif" type="image/gif">
	<style>
		body {
			background-color: black;
			margin: 0;
			padding: 0;
			display: flex;
        	justify-content: center; /* horizontal center */
        	align-items: center; /* vertical center */
        	height: 100vh;
		}
		canvas {
			width: 128;
			height: 128;
			background-color: white;
		}
		#canvasContainer {
			
		}
	</style>
</head>
<body>
<div id="canvasContainer">
	<canvas id="canvas"></canvas>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

const urlParams = new URLSearchParams(window.location.search);
const fps = parseInt(urlParams.get('framerate')) || 30; // Default 30

let blockSize = 32; // Default block size
let frameWidth = 16;
let frameHeight = 16;

// Draw single frame
function drawFrame(frame) {
    if (!frame || !Array.isArray(frame)) return;

    frameHeight = frame.length;
    frameWidth = frame[0].length;

    canvas.width = frameWidth * blockSize;
    canvas.height = frameHeight * blockSize;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let y = 0; y < frameHeight; y++) {
        for (let x = 0; x < frameWidth; x++) {
            if (frame[y][x]) {
                ctx.fillRect(x * blockSize, y * blockSize, blockSize, blockSize);
            }
        }
    }
}

// Animate frame list
function drawFrameList(frameList) {
    if (!Array.isArray(frameList) || frameList.length === 0) {
        console.error('Frame list is empty or invalid');
        return;
    }

    // Auto-detect resolution from first frame
    frameHeight = frameList[0].length;
    frameWidth = frameList[0][0].length;

    // Adjust block size to fit within 512Ã—512 canvas
    const maxCanvasSize = 512;
    blockSize = Math.floor(Math.min(maxCanvasSize / frameWidth, maxCanvasSize / frameHeight));

    canvas.width = frameWidth * blockSize;
    canvas.height = frameHeight * blockSize;

    let currentFrame = 0;
    setInterval(() => {
        drawFrame(frameList[currentFrame]);
        currentFrame = (currentFrame + 1) % frameList.length;
    }, 1000 / fps);
}

// Load frames
fetch('https://www.themango.click/bad-apple/bad-apple-frames.txt')
    .then(response => response.text())
    .then(text => {
        const badapple_frameList = JSON.parse(text);
        console.log(`Loaded ${badapple_frameList.length} frames`);
        drawFrameList(badapple_frameList);
    })
    .catch(error => console.error('Error loading file:', error));

</script>
</body>
</html>
